#Область Локализация

// Переопределение параметров интеграции ВЕТИС (расположения форматированной строки)
//
// Параметры:
//   Форма            - УправляемаяФорма - прикладная форма для встраивания форматированной строки
//   ПараметрыНадписи - Структура        - (см. СобытияФормИС.ПараметрыИнтеграцииДляДокументаОснования)
Процедура ПриОпределенииПараметровИнтеграцииВЕТИС(Форма, ПараметрыНадписи) Экспорт
	
	ФормыДокументовОснований = ПолучитьФормыДокументовОснованийВЕТИС();
	Если Не ФормыДокументовОснований.Найти(Форма.ИмяФормы) = Неопределено Тогда
		ПараметрыНадписи.ИмяРеквизитаФормы = "";
		ПараметрыНадписи.ИмяЭлементаФормы = "";
	КонецЕсли;
		
КонецПроцедуры

Процедура ПослеЗаписиНаСервере(Форма) Экспорт
	
	Возврат;
	
КонецПроцедуры

Процедура ПриСозданииНаСервере(Форма, Отказ, СтандартнаяОбработка) Экспорт
	
	Возврат;
	
КонецПроцедуры


Процедура ПриЧтенииНаСервере(Форма, ТекущийОбъект) Экспорт
	
	Возврат;
	
КонецПроцедуры

#Область СобытияЭлементовФорм

// Серверная переопределяемая процедура, вызываемая из обработчика события элемента.
//
// Параметры:
//   Форма                   - УправляемаяФорма - форма, из которой происходит вызов процедуры.
//   Элемент                 - Строка           - имя элемента-источника события "При изменении"
//   ДополнительныеПараметры - Структура        - значения дополнительных параметров влияющих на обработку.
//
Процедура ПриИзмененииЭлемента(Форма, Элемент, ДополнительныеПараметры) Экспорт
	
	Возврат;
	
КонецПроцедуры

#КонецОбласти

#КонецОбласти


#Область ОбработчикиСобытийЭлементовФормы

// Выполняет действия при изменении номенклатуры в таблице Товары.
//
// Параметры:
//	Форма					- УправляемаяФорма				- Форма, в которой произошло событие.
//	ТекущаяСтрока			- ДанныеФормыЭлементКоллекции 	- Строка таблицы товаров.
//	КэшированныеЗначения	- Структура						- Сохраненные значения параметров, используемых при обработке строки таблицы.
//	ПараметрыЗаполнения		- Структура						- См. функцию ИнтеграцияВЕТИСКлиентСервер.ПараметрыЗаполненияТабличнойЧасти.
//	ПараметрыУказанияСерий	- Структура						- Состав полей определен в функции 
//																НоменклатураКлиентСервер.ПараметрыУказанияСерий.
//
Процедура ПриИзмененииНоменклатуры(Форма,
								ТекущаяСтрока,
								КэшированныеЗначения,
								ПараметрыЗаполнения,
								ПараметрыУказанияСерий = Неопределено) Экспорт
	
	
	Возврат;
	
КонецПроцедуры

// Выполняет действия при изменении номенклатуры в таблице Товары.
//
// Параметры:
//  Форма - УправляемаяФорма - Форма, в которой произошло событие.
//  ТекущаяСтрока - ДанныеФормыЭлементКоллекции - Строка таблицы товаров.
//  КэшированныеЗначения - Структура - Сохраненные значения параметров, используемых при обработке строки таблицы.
//  ПараметрыЗаполнения - (См. ИнтеграцияВЕТИСКлиентСервер.ПараметрыЗаполненияТабличнойЧасти).
//  ПараметрыУказанияСерий - Структура - Состав полей определен в функции 
//                                       НоменклатураКлиентСервер.ПараметрыУказанияСерий.
Процедура ПриИзмененииХарактеристики(Форма,
								ТекущаяСтрока,
								КэшированныеЗначения,
								ПараметрыЗаполнения,
								ПараметрыУказанияСерий = Неопределено) Экспорт
	
	
	Возврат;
	
КонецПроцедуры

// Выполняет действия при изменении количества ВЕТИС в таблице Товары.
//
// Параметры:
//	Форма					- УправляемаяФорма				- Форма, в которой произошло событие.
//	ТекущаяСтрока			- ДанныеФормыЭлементКоллекции 	- Строка таблицы товаров.
//	КэшированныеЗначения	- Структура						- Сохраненные значения параметров, используемых при обработке строки таблицы.
//	ПараметрыЗаполнения		- Структура						- См. функцию ИнтеграцияВЕТИСКлиентСервер.ПараметрыЗаполненияТабличнойЧасти.
//
Процедура ПриИзмененииКоличестваВЕТИС(Форма, ТекущаяСтрока, КэшированныеЗначения, ПараметрыЗаполнения) Экспорт
	
	
	Если ПараметрыЗаполнения.ПересчитатьКоличествоЕдиницПоВЕТИС Тогда
		
		ИмяПоляКоличество      = "Количество" + ПараметрыЗаполнения.Суффикс;
		ИмяПоляКоличествоВЕТИС = "Количество" + ПараметрыЗаполнения.Суффикс + "ВЕТИС";
		
		Если ТекущаяСтрока.Свойство(ИмяПоляКоличество) И ТекущаяСтрока.Свойство(ИмяПоляКоличествоВЕТИС) Тогда
			Если ТекущаяСтрока.Свойство("Номенклатура") Тогда
				ТекущаяСтрока[ИмяПоляКоличество] = ИнтеграцияВЕТИСКлиентСерверПереопределяемый.ПересчитатьКоличествоЕдиниц(
					 ТекущаяСтрока[ИмяПоляКоличествоВЕТИС], ТекущаяСтрока.Номенклатура, ПараметрыЗаполнения.ЕдиницаИзмеренияВЕТИС, КэшированныеЗначения);
			Иначе
				ТекущаяСтрока[ИмяПоляКоличество] = ТекущаяСтрока[ИмяПоляКоличествоВЕТИС];
			КонецЕсли;
		КонецЕсли;
		
	КонецЕсли;
	
КонецПроцедуры

// Выполняет действия при изменении количества в таблице Товары.
//
// Параметры:
//	Форма					- УправляемаяФорма				- Форма, в которой произошло событие.
//	ТекущаяСтрока			- ДанныеФормыЭлементКоллекции 	- Строка таблицы товаров.
//	КэшированныеЗначения	- Структура						- Сохраненные значения параметров, используемых при обработке строки таблицы.
//	ПараметрыЗаполнения		- Структура						- См. функцию ИнтеграцияВЕТИСКлиентСервер.ПараметрыЗаполненияТабличнойЧасти.
//
Процедура ПриИзмененииКоличества(Форма, ТекущаяСтрока, КэшированныеЗначения, ПараметрыЗаполнения) Экспорт
	
	Если ПараметрыЗаполнения.ПересчитатьКоличествоЕдиницВЕТИС Тогда
		
		ИмяПоляКоличество      = "Количество" + ПараметрыЗаполнения.Суффикс;
		ИмяПоляКоличествоВЕТИС = "Количество" + ПараметрыЗаполнения.Суффикс + "ВЕТИС";
		
		Если ТекущаяСтрока.Свойство(ИмяПоляКоличество) И ТекущаяСтрока.Свойство(ИмяПоляКоличествоВЕТИС) Тогда
			Если ТекущаяСтрока.Свойство("Номенклатура") Тогда
				ТекущаяСтрока[ИмяПоляКоличествоВЕТИС] = ИнтеграцияВЕТИСКлиентСерверПереопределяемый.ПересчитатьКоличествоЕдиницВЕТИС(
					 ТекущаяСтрока[ИмяПоляКоличество], ТекущаяСтрока.Номенклатура, ПараметрыЗаполнения.ЕдиницаИзмеренияВЕТИС, КэшированныеЗначения);
			Иначе
				ТекущаяСтрока[ИмяПоляКоличествоВЕТИС] = ТекущаяСтрока[ИмяПоляКоличество];
			КонецЕсли;
		КонецЕсли;
		
	КонецЕсли;
	
КонецПроцедуры

#КонецОбласти

#Область ПрограммныйИнтерфейс

// Заполняет табличную часть Товары подобранными товарами.
//
// Параметры:
//  Форма - УправляемаяФорма - форма, в которой производится подбор,
//  ВыбранноеЗначение - Произвольный - данные, содержащие подобранную пользователем номенклатуру,
//  ПараметрыЗаполнения - Структура - см. функцию СобытияФормВЕТИСКлиентСервер.ПараметрыЗаполненияТабличнойЧасти.
//	ПараметрыУказанияСерий	- Структура						- Состав полей определен в функции 
//																НоменклатураКлиентСервер.ПараметрыУказанияСерий.
//
Процедура ОбработкаРезультатаПодбораНоменклатуры(Форма,
												ВыбранноеЗначение,
												ПараметрыЗаполнения,
												ПараметрыУказанияСерий = Неопределено) Экспорт
	
	
	Возврат;
	
КонецПроцедуры

Функция ПолучитьФормыДокументовОснованийВЕТИС()
	
	ФормыДокументовОснованийВЕТИС = Новый Массив;
	
	ТипыОбъектов = Метаданные.ОпределяемыеТипы.ОснованиеСтатусыОформленияДокументовВЕТИС.Тип.Типы();
	Для Каждого Тип Из ТипыОбъектов Цикл
		ОбъектМетаданныхОснования = Метаданные.НайтиПоТипу(Тип);
		Если Не ОбъектМетаданныхОснования = Неопределено И Лев(ОбъектМетаданныхОснования.ПолноеИмя(), 8) = "Документ" Тогда
			Для Каждого Форма Из ОбъектМетаданныхОснования.Формы Цикл
				Если Форма.Имя = "ФормаВыбора" Или Форма.Имя = "ФормаСписка" Тогда
					Продолжить;
				Иначе
					ФормыДокументовОснованийВЕТИС.Добавить("Документ."+ОбъектМетаданныхОснования.Имя+".Форма."+Форма.Имя);
				КонецЕсли;
			КонецЦикла;
		КонецЕсли;	
	КонецЦикла;
	
	Возврат ФормыДокументовОснованийВЕТИС;
	
КонецФункции

#КонецОбласти
