&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	Если Параметры.Ключ.Пустая() Тогда
		Если Параметры.Свойство("Основание") И Параметры.Основание <> Неопределено Тогда
			Объект.ДатаНачалаТранзакции = Параметры.Основание.Дата;
			Объект.Наименование 		= СформироватьНаименование(Параметры.Основание.ДокументОснование);
			Объект.Предприятие 			= Параметры.Основание.Предприятие;
			Объект.ХозяйствующийСубъект = Параметры.Основание.ХозяйствующийСубъект;
		Иначе
			Объект.ДатаНачалаТранзакции = ТекущаяДата();
		КонецЕсли;
	КонецЕсли;
	
КонецПроцедуры

&НаСервере
Функция СформироватьНаименование(Основание)
	Номер = ПрефиксацияОбъектовКлиентСервер.НомерНаПечать(Основание.Номер, Истина, Истина);
	Дополнение = "";
	Если ТипЗнч(Основание) = Тип("ДокументСсылка.ТребованиеНакладная") Тогда
		Дополнение = Основание.ЦельРасхода.Наименование;
	КонецЕсли;
	Возврат "№ "+Номер+" от "+Формат(Основание.Дата,"ДЛФ=Д")+?(ЗначениеЗаполнено(Дополнение),": "+ Дополнение,"");
КонецФункции

&НаКлиенте
Процедура ПередЗаписью(Отказ, ПараметрыЗаписи)
	
	Если Не ЗначениеЗаполнено(Объект.ДатаНачалаТранзакции) Тогда
		Объект.ДатаНачалаТранзакции = ТекущаяДата();
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура ПослеЗаписи(ПараметрыЗаписи)
	
	Оповестить("СозданаНоваяПроизводственнаяТранзакция");
	
КонецПроцедуры


